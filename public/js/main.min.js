/*! simplechat - v0.0.1 - 2013-07-15 */
!function(a){function b(a,b,c){for(var d=(c||0)-1,e=a.length;++d<e;)if(a[d]===b)return d;return-1}function c(a,c){var d=typeof c;if(a=a.cache,"boolean"==d||null==c)return a[c];"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:t+c;return a=a[d]||(a[d]={}),"object"==d?a[e]&&b(a[e],c)>-1?0:-1:a[e]?0:-1}function d(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:t+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a)==this.array.length&&(b[c]=!1):e[d]=!0}}function e(a){return a.charCodeAt(0)}function f(a,b){var c=a.index,d=b.index;if(a=a.criteria,b=b.criteria,a!==b){if(a>b||"undefined"==typeof a)return 1;if(b>a||"undefined"==typeof b)return-1}return d>c?-1:1}function g(a){var b=-1,c=a.length,e=j();e["false"]=e["null"]=e["true"]=e.undefined=!1;var f=j();for(f.array=a,f.cache=e,f.push=d;++b<c;)f.push(a[b]);return e.object===!1?(l(f),null):f}function h(a){return"\\"+W[a]}function i(){return p.pop()||[]}function j(){return q.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,leading:!1,maxWait:0,"null":!1,number:null,object:null,push:null,string:null,trailing:!1,"true":!1,undefined:!1,value:null}}function k(a){a.length=0,p.length<v&&p.push(a)}function l(a){var b=a.cache;b&&l(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,q.length<v&&q.push(a)}function m(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function n(d){function p(a){return a&&"object"==typeof a&&!Bd(a)&&hd.call(a,"__wrapped__")?a:new q(a)}function q(a){this.__wrapped__=a}function v(a,b,c,d){function e(){var d=arguments,j=g?this:b;if(f||(a=b[h]),c.length&&(d=d.length?(d=wd.call(d),i?d.concat(c):c.concat(d)):c),this instanceof e){j=W(a.prototype);var k=a.apply(j,d);return qb(k)?k:j}return a.apply(j,d)}var f=pb(a),g=!c,h=b;if(g){var i=d;c=b}else if(!f){if(!d)throw new Yc;b=a}return e}function W(a){return qb(a)?nd(a):{}}function X(a){return Ed[a]}function Z(){var a=(a=p.indexOf)===ac?b:a;return a}function _(a){return function(b,c,d,e){return"boolean"!=typeof c&&null!=c&&(e=d,d=e&&e[c]===b?o:c,c=!1),null!=d&&(d=p.createCallback(d,e)),a(b,c,d,e)}}function ab(a){var b,c;return a&&ld.call(a)==R&&(b=a.constructor,!pb(b)||b instanceof b)?(Id(a,function(a,b){c=b}),c===o||hd.call(a,c)):!1}function bb(a){return Fd[a]}function cb(a){return ld.call(a)==L}function db(a,b,c,d,e,f){var g=a;if("boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),"function"==typeof c){if(c="undefined"==typeof d?c:p.createCallback(c,d,1),g=c(g),"undefined"!=typeof g)return g;g=a}var h=qb(g);if(h){var j=ld.call(g);if(!U[j])return g;var l=Bd(g)}if(!h||!b)return h?l?m(g):Gd({},g):g;var n=zd[j];switch(j){case N:case O:return new n(+g);case Q:case T:return new n(g);case S:return n(g.source,B.exec(g))}var q=!e;e||(e=i()),f||(f=i());for(var r=e.length;r--;)if(e[r]==a)return f[r];return g=l?n(g.length):{},l&&(hd.call(a,"index")&&(g.index=a.index),hd.call(a,"input")&&(g.input=a.input)),e.push(a),f.push(g),(l?Jb:Jd)(a,function(a,d){g[d]=db(a,b,c,o,e,f)}),q&&(k(e),k(f)),g}function eb(a,b,c){return db(a,!0,b,c)}function fb(a,b,c){var d;return b=p.createCallback(b,c),Jd(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d}function gb(a){var b=[];return Id(a,function(a,c){pb(a)&&b.push(c)}),b.sort()}function hb(a,b){return a?hd.call(a,b):!1}function ib(a){for(var b=-1,c=Dd(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function jb(a){return a===!0||a===!1||ld.call(a)==N}function kb(a){return a?"object"==typeof a&&ld.call(a)==O:!1}function lb(a){return a?1===a.nodeType:!1}function mb(a){var b=!0;if(!a)return b;var c=ld.call(a),d=a.length;return c==M||c==T||c==L||c==R&&"number"==typeof d&&pb(a.splice)?!d:(Jd(a,function(){return b=!1}),b)}function nb(a,b,c,d,e,f){var g=c===s;if("function"==typeof c&&!g){c=p.createCallback(c,d,2);var h=c(a,b);if("undefined"!=typeof h)return!!h}if(a===b)return 0!==a||1/a==1/b;var j=typeof a,l=typeof b;if(a===a&&(!a||"function"!=j&&"object"!=j)&&(!b||"function"!=l&&"object"!=l))return!1;if(null==a||null==b)return a===b;var m=ld.call(a),n=ld.call(b);if(m==L&&(m=R),n==L&&(n=R),m!=n)return!1;switch(m){case N:case O:return+a==+b;case Q:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case S:case T:return a==Xc(b)}var o=m==M;if(!o){if(hd.call(a,"__wrapped__ ")||hd.call(b,"__wrapped__"))return nb(a.__wrapped__||a,b.__wrapped__||b,c,d,e,f);if(m!=R)return!1;var q=a.constructor,r=b.constructor;if(q!=r&&!(pb(q)&&q instanceof q&&pb(r)&&r instanceof r))return!1}var t=!e;e||(e=i()),f||(f=i());for(var u=e.length;u--;)if(e[u]==a)return f[u]==b;var v=0;if(h=!0,e.push(a),f.push(b),o){if(u=a.length,v=b.length,h=v==a.length,!h&&!g)return h;for(;v--;){var w=u,x=b[v];if(g)for(;w--&&!(h=nb(a[w],x,c,d,e,f)););else if(!(h=nb(a[v],x,c,d,e,f)))break}return h}return Id(b,function(b,g,i){return hd.call(i,g)?(v++,h=hd.call(a,g)&&nb(a[g],b,c,d,e,f)):void 0}),h&&!g&&Id(a,function(a,b,c){return hd.call(c,b)?h=--v>-1:void 0}),t&&(k(e),k(f)),h}function ob(a){return pd(a)&&!qd(parseFloat(a))}function pb(a){return"function"==typeof a}function qb(a){return!(!a||!V[typeof a])}function rb(a){return tb(a)&&a!=+a}function sb(a){return null===a}function tb(a){return"number"==typeof a||ld.call(a)==Q}function ub(a){return a?"object"==typeof a&&ld.call(a)==S:!1}function vb(a){return"string"==typeof a||ld.call(a)==T}function wb(a){return"undefined"==typeof a}function xb(a,b,c){var d=arguments,e=0,f=2;if(!qb(a))return a;if(c===s)var g=d[3],h=d[4],j=d[5];else{var l=!0;h=i(),j=i(),"number"!=typeof c&&(f=d.length),f>3&&"function"==typeof d[f-2]?g=p.createCallback(d[--f-1],d[f--],2):f>2&&"function"==typeof d[f-1]&&(g=d[--f])}for(;++e<f;)(Bd(d[e])?Jb:Jd)(d[e],function(b,c){var d,e,f=b,i=a[c];if(b&&((e=Bd(b))||Kd(b))){for(var k=h.length;k--;)if(d=h[k]==b){i=j[k];break}if(!d){var l;g&&(f=g(i,b),(l="undefined"!=typeof f)&&(i=f)),l||(i=e?Bd(i)?i:[]:Kd(i)?i:{}),h.push(b),j.push(i),l||(i=xb(i,b,s,g,h,j))}}else g&&(f=g(i,b),"undefined"==typeof f&&(f=b)),"undefined"!=typeof f&&(i=f);a[c]=i});return l&&(k(h),k(j)),a}function yb(a,b,c){var d=Z(),e="function"==typeof b,f={};if(e)b=p.createCallback(b,c);else var g=dd.apply(Zc,wd.call(arguments,1));return Id(a,function(a,c,h){(e?!b(a,c,h):d(g,c)<0)&&(f[c]=a)}),f}function zb(a){for(var b=-1,c=Dd(a),d=c.length,e=Pc(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Ab(a,b,c){var d={};if("function"!=typeof b)for(var e=-1,f=dd.apply(Zc,wd.call(arguments,1)),g=qb(a)?f.length:0;++e<g;){var h=f[e];h in a&&(d[h]=a[h])}else b=p.createCallback(b,c),Id(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d}function Bb(a,b,c,d){var e=Bd(a);if(b=p.createCallback(b,d,4),null==c)if(e)c=[];else{var f=a&&a.constructor,g=f&&f.prototype;c=W(g)}return(e?Jb:Jd)(a,function(a,d,e){return b(c,a,d,e)}),c}function Cb(a){for(var b=-1,c=Dd(a),d=c.length,e=Pc(d);++b<d;)e[b]=a[c[b]];return e}function Db(a){for(var b=-1,c=dd.apply(Zc,wd.call(arguments,1)),d=c.length,e=Pc(d);++b<d;)e[b]=a[c[b]];return e}function Eb(a,b,c){var d=-1,e=Z(),f=a?a.length:0,g=!1;return c=(0>c?sd(0,f+c):c)||0,f&&"number"==typeof f?g=(vb(a)?a.indexOf(b,c):e(a,b,c))>-1:Jd(a,function(a){return++d>=c?!(g=a===b):void 0}),g}function Fb(a,b,c){var d={};return b=p.createCallback(b,c),Jb(a,function(a,c,e){c=Xc(b(a,c,e)),hd.call(d,c)?d[c]++:d[c]=1}),d}function Gb(a,b,c){var d=!0;b=p.createCallback(b,c);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&(d=!!b(a[e],e,a)););else Jd(a,function(a,c,e){return d=!!b(a,c,e)});return d}function Hb(a,b,c){var d=[];b=p.createCallback(b,c);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f;){var g=a[e];b(g,e,a)&&d.push(g)}else Jd(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function Ib(a,b,c){b=p.createCallback(b,c);var d=-1,e=a?a.length:0;if("number"!=typeof e){var f;return Jd(a,function(a,c,d){return b(a,c,d)?(f=a,!1):void 0}),f}for(;++d<e;){var g=a[d];if(b(g,d,a))return g}}function Jb(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:p.createCallback(b,c),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==!1;);else Jd(a,b);return a}function Kb(a,b,c){var d={};return b=p.createCallback(b,c),Jb(a,function(a,c,e){c=Xc(b(a,c,e)),(hd.call(d,c)?d[c]:d[c]=[]).push(a)}),d}function Lb(a,b){var c=wd.call(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=Pc("number"==typeof f?f:0);return Jb(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function Mb(a,b,c){var d=-1,e=a?a.length:0;if(b=p.createCallback(b,c),"number"==typeof e)for(var f=Pc(e);++d<e;)f[d]=b(a[d],d,a);else f=[],Jd(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function Nb(a,b,c){var d=-1/0,f=d;if(!b&&Bd(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];i>f&&(f=i)}else b=!b&&vb(a)?e:p.createCallback(b,c),Jb(a,function(a,c,e){var g=b(a,c,e);g>d&&(d=g,f=a)});return f}function Ob(a,b,c){var d=1/0,f=d;if(!b&&Bd(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];f>i&&(f=i)}else b=!b&&vb(a)?e:p.createCallback(b,c),Jb(a,function(a,c,e){var g=b(a,c,e);d>g&&(d=g,f=a)});return f}function Pb(a,b){var c=-1,d=a?a.length:0;if("number"==typeof d)for(var e=Pc(d);++c<d;)e[c]=a[c][b];return e||Mb(a,b)}function Qb(a,b,c,d){if(!a)return c;var e=arguments.length<3;b=p.createCallback(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else Jd(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function Rb(a,b,c,d){var e=a,f=a?a.length:0,g=arguments.length<3;if("number"!=typeof f){var h=Dd(a);f=h.length}return b=p.createCallback(b,d,4),Jb(a,function(a,d,i){d=h?h[--f]:--f,c=g?(g=!1,e[d]):b(c,e[d],d,i)}),c}function Sb(a,b,c){return b=p.createCallback(b,c),Hb(a,function(a,c,d){return!b(a,c,d)})}function Tb(a){var b=-1,c=a?a.length:0,d=Pc("number"==typeof c?c:0);return Jb(a,function(a){var c=ed(vd()*(++b+1));d[b]=d[c],d[c]=a}),d}function Ub(a){var b=a?a.length:0;return"number"==typeof b?b:Dd(a).length}function Vb(a,b,c){var d;b=p.createCallback(b,c);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&!(d=b(a[e],e,a)););else Jd(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function Wb(a,b,c){var d=-1,e=a?a.length:0,g=Pc("number"==typeof e?e:0);for(b=p.createCallback(b,c),Jb(a,function(a,c,e){var f=g[++d]=j();f.criteria=b(a,c,e),f.index=d,f.value=a}),e=g.length,g.sort(f);e--;){var h=g[e];g[e]=h.value,l(h)}return g}function Xb(a){return a&&"number"==typeof a.length?m(a):Cb(a)}function Yb(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function Zb(a){var d=-1,e=Z(),f=a?a.length:0,h=dd.apply(Zc,wd.call(arguments,1)),i=[],j=f>=u&&e===b;if(j){var k=g(h);k?(e=c,h=k):j=!1}for(;++d<f;){var m=a[d];e(h,m)<0&&i.push(m)}return j&&l(h),i}function $b(a,b,c){var d=-1,e=a?a.length:0;for(b=p.createCallback(b,c);++d<e;)if(b(a[d],d,a))return d;return-1}function _b(a,b,c){if(a){var d=0,e=a.length;if("number"!=typeof b&&null!=b){var f=-1;for(b=p.createCallback(b,c);++f<e&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a[0];return m(a,0,td(sd(0,d),e))}}function ac(a,c,d){if("number"==typeof d){var e=a?a.length:0;d=0>d?sd(0,e+d):d||0}else if(d){var f=hc(a,c);return a[f]===c?f:-1}return a?b(a,c,d):-1}function bc(a,b,c){if(!a)return[];var d=0,e=a.length;if("number"!=typeof b&&null!=b){var f=e;for(b=p.createCallback(b,c);f--&&b(a[f],f,a);)d++}else d=null==b||c?1:b||d;return m(a,0,td(sd(0,e-d),e))}function cc(a){for(var d=arguments,e=d.length,f=-1,h=i(),j=-1,m=Z(),n=a?a.length:0,o=[],p=i();++f<e;){var q=d[f];h[f]=m===b&&(q?q.length:0)>=u&&g(f?d[f]:p)}a:for(;++j<n;){var r=h[0];if(q=a[j],(r?c(r,q):m(p,q))<0){for(f=e,(r||p).push(q);--f;)if(r=h[f],(r?c(r,q):m(d[f],q))<0)continue a;o.push(q)}}for(;e--;)r=h[e],r&&l(r);return k(h),k(p),o}function dc(a,b,c){if(a){var d=0,e=a.length;if("number"!=typeof b&&null!=b){var f=e;for(b=p.createCallback(b,c);f--&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a[e-1];return m(a,sd(0,e-d))}}function ec(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?sd(0,d+c):td(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function fc(a,b,c){a=+a||0,c=+c||1,null==b&&(b=a,a=0);for(var d=-1,e=sd(0,bd((b-a)/c)),f=Pc(e);++d<e;)f[d]=a,a+=c;return f}function gc(a,b,c){if("number"!=typeof b&&null!=b){var d=0,e=-1,f=a?a.length:0;for(b=p.createCallback(b,c);++e<f&&b(a[e],e,a);)d++}else d=null==b||c?1:sd(0,b);return m(a,d)}function hc(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?p.createCallback(c,d,1):Dc,b=c(b);f>e;){var g=e+f>>>1;c(a[g])<b?e=g+1:f=g}return e}function ic(a){return Bd(a)||(arguments[0]=a?wd.call(a):Zc),Nd(dd.apply(Zc,arguments))}function jc(a){for(var b=-1,c=a?Nb(Pb(a,"length")):0,d=Pc(0>c?0:c);++b<c;)d[b]=Pb(a,b);return d}function kc(a){return Zb(a,wd.call(arguments,1))}function lc(a){return a?jc(arguments):[]}function mc(a,b){for(var c=-1,d=a?a.length:0,e={};++c<d;){var f=a[c];b?e[f]=b[c]:e[f[0]]=f[1]}return e}function nc(a,b){return 1>a?b():function(){return--a<1?b.apply(this,arguments):void 0}}function oc(a,b){return Ad.fastBind||md&&arguments.length>2?md.call.apply(md,arguments):v(a,b,wd.call(arguments,2))}function pc(a){for(var b=arguments.length>1?dd.apply(Zc,wd.call(arguments,1)):gb(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=oc(a[e],a)}return a}function qc(a,b){return v(a,b,wd.call(arguments,2),s)}function rc(){var a=arguments;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function sc(a,b,c){if(null==a)return Dc;var d=typeof a;if("function"!=d){if("object"!=d)return function(b){return b[a]};var e=Dd(a);return function(b){for(var c=e.length,d=!1;c--&&(d=nb(b[e[c]],a[e[c]],s)););return d}}return"undefined"==typeof b||D&&!D.test(fd.call(a))?a:1===c?function(c){return a.call(b,c)}:2===c?function(c,d){return a.call(b,c,d)}:4===c?function(c,d,e,f){return a.call(b,c,d,e,f)}:function(c,d,e){return a.call(b,c,d,e)}}function tc(a,b,c){function d(){cd(m),cd(n),j=0,m=n=null}function e(){var b=o&&(!p||j>1);d(),b&&(l!==!1&&(k=new Rc),h=a.apply(i,g))}function f(){d(),(o||l!==b)&&(k=new Rc,h=a.apply(i,g))}var g,h,i,j=0,k=0,l=!1,m=null,n=null,o=!0;if(b=sd(0,b||0),c===!0){var p=!0;o=!1}else qb(c)&&(p=c.leading,l="maxWait"in c&&sd(b,c.maxWait||0),o="trailing"in c?c.trailing:o);return function(){if(g=arguments,i=this,j++,cd(n),l===!1)p&&2>j&&(h=a.apply(i,g));else{var c=new Rc;m||p||(k=c);var d=l-(c-k);0>=d?(cd(m),m=null,k=c,h=a.apply(i,g)):m||(m=kd(f,d))}return b!==l&&(n=kd(e,b)),h}}function uc(a){var b=wd.call(arguments,1);return kd(function(){a.apply(o,b)},1)}function vc(a,b){var c=wd.call(arguments,2);return kd(function(){a.apply(o,c)},b)}function wc(a,b){function c(){var d=c.cache,e=t+(b?b.apply(this,arguments):arguments[0]);return hd.call(d,e)?d[e]:d[e]=a.apply(this,arguments)}return c.cache={},c}function xc(a){var b,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function yc(a){return v(a,wd.call(arguments,1))}function zc(a){return v(a,wd.call(arguments,1),null,s)}function Ac(a,b,c){var d=!0,e=!0;c===!1?d=!1:qb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),c=j(),c.leading=d,c.maxWait=b,c.trailing=e;var f=tc(a,b,c);return l(c),f}function Bc(a,b){return function(){var c=[a];return id.apply(c,arguments),b.apply(this,c)}}function Cc(a){return null==a?"":Xc(a).replace(H,X)}function Dc(a){return a}function Ec(a){Jb(gb(a),function(b){var c=p[b]=a[b];p.prototype[b]=function(){var a=this.__wrapped__,b=[a];id.apply(b,arguments);var d=c.apply(p,b);return a&&"object"==typeof a&&a===d?this:new q(d)}})}function Fc(){return d._=_c,this}function Gc(a,b){null==a&&null==b&&(b=1),a=+a||0,null==b?(b=a,a=0):b=+b||0;var c=vd();return a%1||b%1?a+td(c*(b-a+parseFloat("1e-"+((c+"").length-1))),b):a+ed(c*(b-a+1))}function Hc(a,b){var c=a?a[b]:o;return pb(c)?a[b]():c}function Ic(a,b,c){var d=p.templateSettings;a||(a=""),c=Hd({},c,d);var e,f=Hd({},c.imports,d.imports),g=Dd(f),i=Cb(f),j=0,k=c.interpolate||G,l="__p += '",m=Wc((c.escape||G).source+"|"+k.source+"|"+(k===C?A:G).source+"|"+(c.evaluate||G).source+"|$","g");a.replace(m,function(b,c,d,f,g,i){return d||(d=f),l+=a.slice(j,i).replace(I,h),c&&(l+="' +\n__e("+c+") +\n'"),g&&(e=!0,l+="';\n"+g+";\n__p += '"),d&&(l+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),j=i+b.length,b}),l+="';\n";var n=c.variable,q=n;q||(n="obj",l="with ("+n+") {\n"+l+"\n}\n"),l=(e?l.replace(w,""):l).replace(x,"$1").replace(y,"$1;"),l="function("+n+") {\n"+(q?"":n+" || ("+n+" = {});\n")+"var __t, __p = '', __e = _.escape"+(e?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var r="\n/*\n//@ sourceURL="+(c.sourceURL||"/lodash/template/source["+K++ +"]")+"\n*/";try{var s=Sc(g,"return "+l+r).apply(o,i)}catch(t){throw t.source=l,t}return b?s(b):(s.source=l,s)}function Jc(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=Pc(a);for(b=p.createCallback(b,c,1);++d<a;)e[d]=b(d);return e}function Kc(a){return null==a?"":Xc(a).replace(z,bb)}function Lc(a){var b=++r;return Xc(null==a?"":a)+b}function Mc(a,b){return b(a),a}function Nc(){return Xc(this.__wrapped__)}function Oc(){return this.__wrapped__}d=d?$.defaults(a.Object(),d,$.pick(a,J)):a;var Pc=d.Array,Qc=d.Boolean,Rc=d.Date,Sc=d.Function,Tc=d.Math,Uc=d.Number,Vc=d.Object,Wc=d.RegExp,Xc=d.String,Yc=d.TypeError,Zc=[],$c=Vc.prototype;Xc.prototype;var _c=d._,ad=Wc("^"+Xc($c.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),bd=Tc.ceil,cd=d.clearTimeout,dd=Zc.concat,ed=Tc.floor,fd=Sc.prototype.toString,gd=ad.test(gd=Vc.getPrototypeOf)&&gd,hd=$c.hasOwnProperty,id=Zc.push,jd=($c.propertyIsEnumerable,d.setImmediate),kd=d.setTimeout,ld=$c.toString,md=ad.test(md=ld.bind)&&md,nd=ad.test(nd=Vc.create)&&nd,od=ad.test(od=Pc.isArray)&&od,pd=d.isFinite,qd=d.isNaN,rd=ad.test(rd=Vc.keys)&&rd,sd=Tc.max,td=Tc.min,ud=d.parseInt,vd=Tc.random,wd=Zc.slice,xd=ad.test(d.attachEvent),yd=md&&!/\n|true/.test(md+xd),zd={};zd[M]=Pc,zd[N]=Qc,zd[O]=Rc,zd[P]=Sc,zd[R]=Vc,zd[Q]=Uc,zd[S]=Wc,zd[T]=Xc,q.prototype=p.prototype;var Ad=p.support={};Ad.fastBind=md&&!yd,p.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:C,variable:"",imports:{_:p}};var Bd=od,Cd=function(a){var b,c=a,d=[];if(!c)return d;if(!V[typeof a])return d;for(b in c)hd.call(c,b)&&d.push(b);return d},Dd=rd?function(a){return qb(a)?rd(a):[]}:Cd,Ed={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Fd=ib(Ed),Gd=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=p.createCallback(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if(e=g[h],e&&V[typeof e])for(var k=-1,l=V[typeof e]&&Dd(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f},Hd=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&V[typeof e])for(var j=-1,k=V[typeof e]&&Dd(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},Id=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!V[typeof e])return f;b=b&&"undefined"==typeof c?b:p.createCallback(b,c);for(d in e)if(b(e[d],d,a)===!1)return f;return f},Jd=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!V[typeof e])return f;b=b&&"undefined"==typeof c?b:p.createCallback(b,c);for(var g=-1,h=V[typeof e]&&Dd(e),i=h?h.length:0;++g<i;)if(d=h[g],b(e[d],d,a)===!1)return f;return f},Kd=function(a){if(!a||ld.call(a)!=R)return!1;var b=a.valueOf,c="function"==typeof b&&(c=gd(b))&&gd(c);return c?a==c||gd(a)==c:ab(a)},Ld=Hb,Md=_(function Pd(a,b,c){for(var d=-1,e=a?a.length:0,f=[];++d<e;){var g=a[d];c&&(g=c(g,d,a)),Bd(g)?id.apply(f,b?g:Pd(g)):f.push(g)}return f}),Nd=_(function(a,d,e){var f=-1,h=Z(),j=a?a.length:0,m=[],n=!d&&j>=u&&h===b,o=e||n?i():m;if(n){var p=g(o);p?(h=c,o=p):(n=!1,o=e?o:(k(o),m))}for(;++f<j;){var q=a[f],r=e?e(q,f,a):q;(d?!f||o[o.length-1]!==r:h(o,r)<0)&&((e||n)&&o.push(r),m.push(q))}return n?(k(o.array),l(o)):e&&k(o),m});yd&&Y&&"function"==typeof jd&&(uc=oc(jd,d));var Od=8==ud(E+"08")?ud:function(a,b){return ud(vb(a)?a.replace(F,""):a,b||0)};return p.after=nc,p.assign=Gd,p.at=Db,p.bind=oc,p.bindAll=pc,p.bindKey=qc,p.compact=Yb,p.compose=rc,p.countBy=Fb,p.createCallback=sc,p.debounce=tc,p.defaults=Hd,p.defer=uc,p.delay=vc,p.difference=Zb,p.filter=Hb,p.flatten=Md,p.forEach=Jb,p.forIn=Id,p.forOwn=Jd,p.functions=gb,p.groupBy=Kb,p.initial=bc,p.intersection=cc,p.invert=ib,p.invoke=Lb,p.keys=Dd,p.map=Mb,p.max=Nb,p.memoize=wc,p.merge=xb,p.min=Ob,p.omit=yb,p.once=xc,p.pairs=zb,p.partial=yc,p.partialRight=zc,p.pick=Ab,p.pluck=Pb,p.range=fc,p.reject=Sb,p.rest=gc,p.shuffle=Tb,p.sortBy=Wb,p.tap=Mc,p.throttle=Ac,p.times=Jc,p.toArray=Xb,p.transform=Bb,p.union=ic,p.uniq=Nd,p.unzip=jc,p.values=Cb,p.where=Ld,p.without=kc,p.wrap=Bc,p.zip=lc,p.zipObject=mc,p.collect=Mb,p.drop=gc,p.each=Jb,p.extend=Gd,p.methods=gb,p.object=mc,p.select=Hb,p.tail=gc,p.unique=Nd,Ec(p),p.chain=p,p.prototype.chain=function(){return this},p.clone=db,p.cloneDeep=eb,p.contains=Eb,p.escape=Cc,p.every=Gb,p.find=Ib,p.findIndex=$b,p.findKey=fb,p.has=hb,p.identity=Dc,p.indexOf=ac,p.isArguments=cb,p.isArray=Bd,p.isBoolean=jb,p.isDate=kb,p.isElement=lb,p.isEmpty=mb,p.isEqual=nb,p.isFinite=ob,p.isFunction=pb,p.isNaN=rb,p.isNull=sb,p.isNumber=tb,p.isObject=qb,p.isPlainObject=Kd,p.isRegExp=ub,p.isString=vb,p.isUndefined=wb,p.lastIndexOf=ec,p.mixin=Ec,p.noConflict=Fc,p.parseInt=Od,p.random=Gc,p.reduce=Qb,p.reduceRight=Rb,p.result=Hc,p.runInContext=n,p.size=Ub,p.some=Vb,p.sortedIndex=hc,p.template=Ic,p.unescape=Kc,p.uniqueId=Lc,p.all=Gb,p.any=Vb,p.detect=Ib,p.findWhere=Ib,p.foldl=Qb,p.foldr=Rb,p.include=Eb,p.inject=Qb,Jd(p,function(a,b){p.prototype[b]||(p.prototype[b]=function(){var b=[this.__wrapped__];return id.apply(b,arguments),a.apply(p,b)})}),p.first=_b,p.last=dc,p.take=_b,p.head=_b,Jd(p,function(a,b){p.prototype[b]||(p.prototype[b]=function(b,c){var d=a(this.__wrapped__,b,c);return null==b||c&&"function"!=typeof b?d:new q(d)})}),p.VERSION="1.3.1",p.prototype.toString=Nc,p.prototype.value=Oc,p.prototype.valueOf=Oc,Jb(["join","pop","shift"],function(a){var b=Zc[a];p.prototype[a]=function(){return b.apply(this.__wrapped__,arguments)}}),Jb(["push","reverse","sort","unshift"],function(a){var b=Zc[a];p.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Jb(["concat","slice","splice"],function(a){var b=Zc[a];p.prototype[a]=function(){return new q(b.apply(this.__wrapped__,arguments))}}),p}var o,p=[],q=[],r=0,s={},t=+new Date+"",u=75,v=40,w=/\b__p \+= '';/g,x=/\b(__p \+=) '' \+/g,y=/(__e\(.*?\)|\b__t\)) \+\n'';/g,z=/&(?:amp|lt|gt|quot|#39);/g,A=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,B=/\w*$/,C=/<%=([\s\S]+?)%>/g,D=(D=/\bthis\b/)&&D.test(n)&&D,E=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",F=RegExp("^["+E+"]*0+(?=.$)"),G=/($^)/,H=/[&<>"']/g,I=/['\n\r\t\u2028\u2029\\]/g,J=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],K=0,L="[object Arguments]",M="[object Array]",N="[object Boolean]",O="[object Date]",P="[object Function]",Q="[object Number]",R="[object Object]",S="[object RegExp]",T="[object String]",U={};U[P]=!1,U[L]=U[M]=U[N]=U[O]=U[Q]=U[R]=U[S]=U[T]=!0;var V={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},W={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},X=V[typeof exports]&&exports,Y=V[typeof module]&&module&&module.exports==X&&module,Z=V[typeof global]&&global;!Z||Z.global!==Z&&Z.window!==Z||(a=Z);var $=n();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(a._=$,define(function(){return $})):X&&!X.nodeType?Y?(Y.exports=$)._=$:X._=$:a._=$}(this),function(){var a,b=this,c=b.Backbone,d=[],e=d.push,f=d.slice,g=d.splice;a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.0.0";var h=b._;h||"undefined"==typeof require||(h=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var i=a.Events={on:function(a,b,c){if(!k(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!k(this,"once",a,[b,c])||!b)return this;var d=this,e=h.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,i,j,l,m;if(!this._events||!k(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:h.keys(this._events),i=0,j=g.length;j>i;i++)if(a=g[i],f=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=f.length;m>l;l++)e=f[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=f.call(arguments,1);if(!k(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&l(c,b),d&&l(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},j=/\s+/,k=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(j.test(c)){for(var f=c.split(j),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},l=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},m={listenTo:"on",listenToOnce:"once"};h.each(m,function(a,b){i[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=h.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),i.bind=i.on,i.unbind=i.off,h.extend(a,i);var n=a.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=h.uniqueId("c"),this.attributes={},h.extend(this,h.pick(b,o)),b.parse&&(d=this.parse(d,b)||{}),(c=h.result(this,"defaults"))&&(d=h.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},o=["url","urlRoot","collection"];h.extend(n.prototype,i,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,i=c.silent,g=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=h.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(l[d],b)||g.push(d),h.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!i){g.length&&(this._pending=!0);for(var m=0,n=g.length;n>m;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)h.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),b.trigger("sync",b,d,a),void 0):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,!(!d||c&&c.wait||this.set(d,c)))return!1;if(c=h.extend({validate:!0},c),!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=h.extend({},g,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=g;var b=i.parse(a,c);return c.wait&&(b=h.extend(d||{},b)),h.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),i.trigger("sync",i,a,c),void 0)},L(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;L(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||K();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,h.extend(b||{},{validationError:c})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];h.each(p,function(a){n.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.attributes),h[a].apply(h,b)}});var q=a.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))},r={add:!0,remove:!0,merge:!0},s={add:!0,merge:!1,remove:!1};h.extend(q.prototype,i,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,h.defaults(b||{},s))},remove:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=this.get(a[c]),f&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},set:function(a,b){b=h.defaults(b||{},r),b.parse&&(a=this.parse(a,b)),h.isArray(a)||(a=a?[a]:[]);var c,d,f,i,j,k=b.at,l=this.comparator&&null==k&&b.sort!==!1,m=h.isString(this.comparator)?this.comparator:null,n=[],o=[],p={};for(c=0,d=a.length;d>c;c++)(f=this._prepareModel(a[c],b))&&((i=this.get(f))?(b.remove&&(p[i.cid]=!0),b.merge&&(i.set(f.attributes,b),l&&!j&&i.hasChanged(m)&&(j=!0))):b.add&&(n.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f)));if(b.remove){for(c=0,d=this.length;d>c;++c)p[(f=this.models[c]).cid]||o.push(f);o.length&&this.remove(o,b)}if(n.length&&(l&&(j=!0),this.length+=n.length,null!=k?g.apply(this.models,[k,0].concat(n)):e.apply(this.models,n)),j&&this.sort({silent:!0}),b.silent)return this;for(c=0,d=n.length;d>c;c++)(f=n[c]).trigger("add",f,this,b);return j&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:this.length},b)),a
},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return h.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)},pluck:function(a){return h.invoke(this.models,"get",a)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?h.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof n)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var t=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(t,function(a){q.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.models),h[a].apply(h,b)}});var u=["groupBy","countBy","sortBy"];h.each(u,function(a){q.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var v=a.View=function(a){this.cid=h.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];h.extend(v.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=h.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(h.isFunction(c)||(c=this[a[b]]),c){var d=b.match(w),e=d[1],f=d[2];c=h.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a)),h.extend(this,h.pick(a,x)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(h.result(this,"el"),!1);else{var b=h.extend({},h.result(this,"attributes"));this.id&&(b.id=h.result(this,"id")),this.className&&(b["class"]=h.result(this,"className"));var c=a.$("<"+h.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=y[b];h.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var f={type:e,dataType:"json"};if(d.url||(f.url=h.result(c,"url")||K()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(f.contentType="application/json",f.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){f.type="POST",d.emulateJSON&&(f.data._method=e);var g=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),g?g.apply(this,arguments):void 0}}"GET"===f.type||d.emulateJSON||(f.processData=!1),"PATCH"!==f.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(h.extend(f,d));return c.trigger("request",c,i,d),i};var y={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var z=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,B=/(\(\?)?:\w+/g,C=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(z.prototype,i,{initialize:function(){},route:function(b,c,d){h.isRegExp(b)||(b=this._routeToRegExp(b)),h.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=h.result(this,"routes");for(var a,b=h.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(D,"\\$&").replace(A,"(?:$1)?").replace(B,function(a,b){return b?a:"([^/]+)"}).replace(C,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return h.map(c,function(a){return a?decodeURIComponent(a):null})}});var E=a.History=function(){this.handlers=[],h.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,H=/msie [\w.]+/,I=/\/$/;E.started=!1,h.extend(E.prototype,i,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(I,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(F,"")},start:function(b){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=h.extend({},{root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=H.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(G,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var f=this.location,g=f.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&g&&f.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+f.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=h.any(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){if(!E.started)return!1;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new E;var J=function(a,b){var c,d=this;c=a&&h.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},h.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&h.extend(c.prototype,a),c.__super__=d.prototype,c};n.extend=q.extend=z.extend=v.extend=E.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),!function(a){"use strict";function b(){a(".dropdown-backdrop").remove(),a(d).each(function(){c(a(this)).removeClass("open")})}function c(b){var c,d=b.attr("data-target");return d||(d=b.attr("href"),d=d&&/#/.test(d)&&d.replace(/.*(?=#[^\s]*$)/,"")),c=d&&a(d),c&&c.length||(c=b.parent()),c}var d="[data-toggle=dropdown]",e=function(b){var c=a(b).on("click.dropdown.data-api",this.toggle);a("html").on("click.dropdown.data-api",function(){c.parent().removeClass("open")})};e.prototype={constructor:e,toggle:function(){var d,e,f=a(this);if(!f.is(".disabled, :disabled"))return d=c(f),e=d.hasClass("open"),b(),e||("ontouchstart"in document.documentElement&&a('<div class="dropdown-backdrop"/>').insertBefore(a(this)).on("click",b),d.toggleClass("open")),f.focus(),!1},keydown:function(b){var e,f,g,h,i;if(/(38|40|27)/.test(b.keyCode)&&(e=a(this),b.preventDefault(),b.stopPropagation(),!e.is(".disabled, :disabled"))){if(g=c(e),h=g.hasClass("open"),!h||h&&27==b.keyCode)return 27==b.which&&g.find(d).focus(),e.click();f=a("[role=menu] li:not(.divider):visible a",g),f.length&&(i=f.index(f.filter(":focus")),38==b.keyCode&&i>0&&i--,40==b.keyCode&&i<f.length-1&&i++,~i||(i=0),f.eq(i).focus())}}};var f=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data("dropdown");d||c.data("dropdown",d=new e(this)),"string"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=e,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=f,this},a(document).on("click.dropdown.data-api",b).on("click.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.dropdown.data-api",d,e.prototype.toggle).on("keydown.dropdown.data-api",d+", [role=menu]",e.prototype.keydown)}(window.jQuery),!function(a){var b=function(b,c){this.element=a(b),this.picker=a('<div class="slider"><div class="slider-track"><div class="slider-selection"></div><div class="slider-handle"></div><div class="slider-handle"></div></div><div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div></div>').insertBefore(this.element).append(this.element),this.id=this.element.data("slider-id")||c.id,this.id&&(this.picker[0].id=this.id),"undefined"!=typeof Modernizr&&Modernizr.touch&&(this.touchCapable=!0);var d=this.element.data("slider-tooltip")||c.tooltip;switch(this.tooltip=this.picker.find(".tooltip"),this.tooltipInner=this.tooltip.find("div.tooltip-inner"),this.orientation=this.element.data("slider-orientation")||c.orientation,this.orientation){case"vertical":this.picker.addClass("slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight",this.tooltip.addClass("right")[0].style.left="100%";break;default:this.picker.addClass("slider-horizontal").css("width",this.element.outerWidth()),this.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth",this.tooltip.addClass("top")[0].style.top=-this.tooltip.outerHeight()-14+"px"}this.min=this.element.data("slider-min")||c.min,this.max=this.element.data("slider-max")||c.max,this.step=this.element.data("slider-step")||c.step,this.value=this.element.data("slider-value")||c.value,this.value[1]&&(this.range=!0),this.selection=this.element.data("slider-selection")||c.selection,this.selectionEl=this.picker.find(".slider-selection"),"none"===this.selection&&this.selectionEl.addClass("hide"),this.selectionElStyle=this.selectionEl[0].style,this.handle1=this.picker.find(".slider-handle:first"),this.handle1Stype=this.handle1[0].style,this.handle2=this.picker.find(".slider-handle:last"),this.handle2Stype=this.handle2[0].style;var e=this.element.data("slider-handle")||c.handle;switch(e){case"round":this.handle1.addClass("round"),this.handle2.addClass("round");break;case"triangle":this.handle1.addClass("triangle"),this.handle2.addClass("triangle")}this.range?(this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0])),this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))):(this.value=[Math.max(this.min,Math.min(this.max,this.value))],this.handle2.addClass("hide"),this.value[1]="after"==this.selection?this.max:this.min),this.diff=this.max-this.min,this.percentage=[100*(this.value[0]-this.min)/this.diff,100*(this.value[1]-this.min)/this.diff,100*this.step/this.diff],this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos],this.formater=c.formater,this.layout(),this.touchCapable?this.picker.on({touchstart:a.proxy(this.mousedown,this)}):this.picker.on({mousedown:a.proxy(this.mousedown,this)}),"show"===d?this.picker.on({mouseenter:a.proxy(this.showTooltip,this),mouseleave:a.proxy(this.hideTooltip,this)}):this.tooltip.addClass("hide")};b.prototype={constructor:b,over:!1,inDrag:!1,showTooltip:function(){this.tooltip.addClass("in"),this.over=!0},hideTooltip:function(){this.inDrag===!1&&this.tooltip.removeClass("in"),this.over=!1},layout:function(){this.handle1Stype[this.stylePos]=this.percentage[0]+"%",this.handle2Stype[this.stylePos]=this.percentage[1]+"%","vertical"==this.orientation?(this.selectionElStyle.top=Math.min(this.percentage[0],this.percentage[1])+"%",this.selectionElStyle.height=Math.abs(this.percentage[0]-this.percentage[1])+"%"):(this.selectionElStyle.left=Math.min(this.percentage[0],this.percentage[1])+"%",this.selectionElStyle.width=Math.abs(this.percentage[0]-this.percentage[1])+"%"),this.range?(this.tooltipInner.text(this.formater(this.value[0])+" : "+this.formater(this.value[1])),this.tooltip[0].style[this.stylePos]=this.size*(this.percentage[0]+(this.percentage[1]-this.percentage[0])/2)/100-("vertical"===this.orientation?this.tooltip.outerHeight()/2:this.tooltip.outerWidth()/2)+"px"):(this.tooltipInner.text(this.formater(this.value[0])),this.tooltip[0].style[this.stylePos]=this.size*this.percentage[0]/100-("vertical"===this.orientation?this.tooltip.outerHeight()/2:this.tooltip.outerWidth()/2)+"px")},mousedown:function(b){this.touchCapable&&"touchstart"===b.type&&(b=b.originalEvent),this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos];var c=this.getPercentage(b);if(this.range){var d=Math.abs(this.percentage[0]-c),e=Math.abs(this.percentage[1]-c);this.dragged=e>d?0:1}else this.dragged=0;this.percentage[this.dragged]=c,this.layout(),this.touchCapable?a(document).on({touchmove:a.proxy(this.mousemove,this),touchend:a.proxy(this.mouseup,this)}):a(document).on({mousemove:a.proxy(this.mousemove,this),mouseup:a.proxy(this.mouseup,this)}),this.inDrag=!0;var f=this.calculateValue();return this.element.trigger({type:"slideStart",value:f}).trigger({type:"slide",value:f}),!1},mousemove:function(a){this.touchCapable&&"touchmove"===a.type&&(a=a.originalEvent);var b=this.getPercentage(a);this.range&&(0===this.dragged&&this.percentage[1]<b?(this.percentage[0]=this.percentage[1],this.dragged=1):1===this.dragged&&this.percentage[0]>b&&(this.percentage[1]=this.percentage[0],this.dragged=0)),this.percentage[this.dragged]=b,this.layout();var c=this.calculateValue();return this.element.trigger({type:"slide",value:c}).data("value",c).prop("value",c),!1},mouseup:function(){this.touchCapable?a(document).off({touchmove:this.mousemove,touchend:this.mouseup}):a(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.inDrag=!1,0==this.over&&this.hideTooltip(),this.element;var b=this.calculateValue();return this.element.trigger({type:"slideStop",value:b}).data("value",b).prop("value",b),!1},calculateValue:function(){var a;return this.range?(a=[this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step,this.min+Math.round(this.diff*this.percentage[1]/100/this.step)*this.step],this.value=a):(a=this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step,this.value=[a,this.value[1]]),a},getPercentage:function(a){this.touchCapable&&(a=a.touches[0]);var b=100*(a[this.mousePos]-this.offset[this.stylePos])/this.size;return b=Math.round(b/this.percentage[2])*this.percentage[2],Math.max(0,Math.min(100,b))},getValue:function(){return this.range?this.value:this.value[0]},setValue:function(a){this.value=a,this.range?(this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0])),this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))):(this.value=[Math.max(this.min,Math.min(this.max,this.value))],this.handle2.addClass("hide"),this.value[1]="after"==this.selection?this.max:this.min),this.diff=this.max-this.min,this.percentage=[100*(this.value[0]-this.min)/this.diff,100*(this.value[1]-this.min)/this.diff,100*this.step/this.diff],this.layout()}},a.fn.slider=function(c,d){return this.each(function(){var e=a(this),f=e.data("slider"),g="object"==typeof c&&c;f||e.data("slider",f=new b(this,a.extend({},a.fn.slider.defaults,g))),"string"==typeof c&&f[c](d)})},a.fn.slider.defaults={min:0,max:10,step:1,orientation:"horizontal",value:5,selection:"before",tooltip:"show",handle:"round",formater:function(a){return a}},a.fn.slider.Constructor=b}(window.jQuery),("undefined"==typeof window.localStorage||"undefined"==typeof window.sessionStorage)&&function(){var a=function(a){function b(a,b,c){var d,e;c?(d=new Date,d.setTime(d.getTime()+1e3*60*60*24*c),e="; expires="+d.toGMTString()):e="",document.cookie=a+"="+b+e+"; path=/"}function c(a){var b,c,d=a+"=",e=document.cookie.split(";");for(b=0;b<e.length;b++){for(c=e[b];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(d))return c.substring(d.length,c.length)}return null}function d(c){c=JSON.stringify(c),"session"==a?window.name=c:b("localStorage",c,365)}function e(){"session"==a?window.name="":b("localStorage","",365)}function f(){var b="session"==a?window.name:c("localStorage");return b?JSON.parse(b):{}}var g=f();return{length:0,clear:function(){g={},this.length=0,e()},getItem:function(a){return void 0===g[a]?null:g[a]},key:function(a){var b=0;for(var c in g){if(b==a)return c;b++}return null},removeItem:function(a){delete g[a],this.length--,d(g)},setItem:function(a,b){g[a]=b+"",this.length++,d(g)}}};"undefined"==typeof window.localStorage&&(window.localStorage=new a("local")),"undefined"==typeof window.sessionStorage&&(window.sessionStorage=new a("session"))}(),function(a,b,c){var d=function(){for(var a=new RegExp("audio(.min)?.js.*"),b=document.getElementsByTagName("script"),c=0,d=b.length;d>c;c++){var e=b[c].getAttribute("src");if(a.test(e))return e.replace(a,"")}}();c[a]={instanceCount:0,instances:{},flashSource:'      <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="$1" width="1" height="1" name="$1" style="position: absolute; left: -1px;">         <param name="movie" value="$2?playerInstance='+a+'.instances[\'$1\']&datetime=$3">         <param name="allowscriptaccess" value="always">         <embed name="$1" src="$2?playerInstance='+a+'.instances[\'$1\']&datetime=$3" width="1" height="1" allowscriptaccess="always">       </object>',settings:{autoplay:!1,loop:!1,preload:!0,imageLocation:d+"player-graphics.gif",swfLocation:d+"audiojs.swf",useFlash:function(){var a=document.createElement("audio");return!(a.canPlayType&&a.canPlayType("audio/mpeg;").replace(/no/,""))}(),hasFlash:function(){if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"])return!0;if(navigator.mimeTypes&&navigator.mimeTypes.length){var a=navigator.mimeTypes["application/x-shockwave-flash"];return a&&a.enabledPlugin}try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),!0}catch(b){}return!1}(),createPlayer:{markup:'          <div class="play-pause">             <p class="play"></p>             <p class="pause"></p>             <p class="loading"></p>             <p class="error"></p>           </div>           <div class="scrubber">             <div class="progress"></div>             <div class="loaded"></div>           </div>           <div class="time">             <em class="played">00:00</em>/<strong class="duration">00:00</strong>           </div>           <div class="error-message"></div>',playPauseClass:"play-pause",scrubberClass:"scrubber",progressClass:"progress",loaderClass:"loaded",timeClass:"time",durationClass:"duration",playedClass:"played",errorMessageClass:"error-message",playingClass:"playing",loadingClass:"loading",errorClass:"error"},trackEnded:function(){},flashError:function(){var b=this.settings.createPlayer,d=e(b.errorMessageClass,this.wrapper),f='Missing <a href="http://get.adobe.com/flashplayer/">flash player</a> plugin.';this.mp3&&(f+=' <a href="'+this.mp3+'">Download audio file</a>.'),c[a].helpers.removeClass(this.wrapper,b.loadingClass),c[a].helpers.addClass(this.wrapper,b.errorClass),d.innerHTML=f},loadError:function(){var b=this.settings.createPlayer,d=e(b.errorMessageClass,this.wrapper);c[a].helpers.removeClass(this.wrapper,b.loadingClass),c[a].helpers.addClass(this.wrapper,b.errorClass),d.innerHTML='Error loading: "'+this.mp3+'"'},init:function(){var b=this.settings.createPlayer;c[a].helpers.addClass(this.wrapper,b.loadingClass)},loadStarted:function(){var b=this.settings.createPlayer,d=e(b.durationClass,this.wrapper),f=Math.floor(this.duration/60),g=Math.floor(this.duration%60);c[a].helpers.removeClass(this.wrapper,b.loadingClass),d.innerHTML=(10>f?"0":"")+f+":"+(10>g?"0":"")+g},loadProgress:function(a){var b=this.settings.createPlayer,c=e(b.scrubberClass,this.wrapper),d=e(b.loaderClass,this.wrapper);d.style.width=c.offsetWidth*a+"px"},playPause:function(){this.playing?this.settings.play():this.settings.pause()},play:function(){var b=this.settings.createPlayer;c[a].helpers.addClass(this.wrapper,b.playingClass)},pause:function(){var b=this.settings.createPlayer;c[a].helpers.removeClass(this.wrapper,b.playingClass)},updatePlayhead:function(a){var b=this.settings.createPlayer,c=e(b.scrubberClass,this.wrapper),d=e(b.progressClass,this.wrapper);d.style.width=c.offsetWidth*a+"px";var f=e(b.playedClass,this.wrapper),g=this.duration*a,h=Math.floor(g/60),i=Math.floor(g%60);f.innerHTML=(10>h?"0":"")+h+":"+(10>i?"0":"")+i}},create:function(a,b){var b=b||{};return a.length?this.createAll(b,a):this.newInstance(a,b)},createAll:function(a,b){var c=b||document.getElementsByTagName("audio"),d=[];a=a||{};for(var e=0,f=c.length;f>e;e++)d.push(this.newInstance(c[e],a));return d},newInstance:function(a,d){var a=a,e=this.helpers.clone(this.settings),f="audiojs"+this.instanceCount,g="audiojs_wrapper"+this.instanceCount;this.instanceCount++,null!=a.getAttribute("autoplay")&&(e.autoplay=!0),null!=a.getAttribute("loop")&&(e.loop=!0),"none"==a.getAttribute("preload")&&(e.preload=!1),d&&this.helpers.merge(e,d),e.createPlayer.markup?a=this.createPlayer(a,e.createPlayer,g):a.parentNode.setAttribute("id",g);var h=new c[b](a,e);return e.useFlash&&e.hasFlash?(this.injectFlash(h,f),this.attachFlashEvents(h.wrapper,h)):e.useFlash&&!e.hasFlash&&this.settings.flashError.apply(h),(!e.useFlash||e.useFlash&&e.hasFlash)&&this.attachEvents(h.wrapper,h),this.instances[f]=h,h},createPlayer:function(a,b,c){var d=document.createElement("div"),e=a.cloneNode(!0);return d.setAttribute("class","audiojs"),d.setAttribute("className","audiojs"),d.setAttribute("id",c),e.outerHTML&&!document.createElement("audio").canPlayType?(e=this.helpers.cloneHtml5Node(a),d.innerHTML=b.markup,d.appendChild(e),a.outerHTML=d.outerHTML,d=document.getElementById(c)):(d.appendChild(e),d.innerHTML=d.innerHTML+b.markup,a.parentNode.replaceChild(d,a)),d.getElementsByTagName("audio")[0]},attachEvents:function(b,d){if(d.settings.createPlayer){var f=d.settings.createPlayer,g=e(f.playPauseClass,b),h=e(f.scrubberClass,b),i=function(a){var b=0;if(a.offsetParent)do b+=a.offsetLeft;while(a=a.offsetParent);return b};c[a].events.addListener(g,"click",function(){d.playPause.apply(d)}),c[a].events.addListener(h,"click",function(a){var b=a.clientX-i(this);d.skipTo(b/h.offsetWidth)}),d.settings.useFlash||(c[a].events.trackLoadProgress(d),c[a].events.addListener(d.element,"timeupdate",function(){d.updatePlayhead.apply(d)}),c[a].events.addListener(d.element,"ended",function(){d.trackEnded.apply(d)}),c[a].events.addListener(d.source,"error",function(){clearInterval(d.readyTimer),clearInterval(d.loadTimer),d.settings.loadError.apply(d)}))}},attachFlashEvents:function(a,b){b.swfReady=!1,b.load=function(a){b.mp3=a,b.swfReady&&b.element.load(a)},b.loadProgress=function(a,c){b.loadedPercent=a,b.duration=c,b.settings.loadStarted.apply(b),b.settings.loadProgress.apply(b,[a])},b.skipTo=function(a){a>b.loadedPercent||(b.updatePlayhead.call(b,[a]),b.element.skipTo(a))},b.updatePlayhead=function(a){b.settings.updatePlayhead.apply(b,[a])},b.play=function(){b.settings.preload||(b.settings.preload=!0,b.element.init(b.mp3)),b.playing=!0,b.element.pplay(),b.settings.play.apply(b)},b.pause=function(){b.playing=!1,b.element.ppause(),b.settings.pause.apply(b)},b.setVolume=function(a){b.element.setVolume(a)},b.loadStarted=function(){b.swfReady=!0,b.settings.preload&&b.element.init(b.mp3),b.settings.autoplay&&b.play.apply(b)}},injectFlash:function(a,b){var c=this.flashSource.replace(/\$1/g,b);c=c.replace(/\$2/g,a.settings.swfLocation),c=c.replace(/\$3/g,+new Date+Math.random());var d=a.wrapper.innerHTML,e=document.createElement("div");e.innerHTML=c+d,a.wrapper.innerHTML=e.innerHTML,a.element=this.helpers.getSwf(b)},helpers:{merge:function(a,b){for(attr in b)(a.hasOwnProperty(attr)||b.hasOwnProperty(attr))&&(a[attr]=b[attr])},clone:function(a){if(null==a||"object"!=typeof a)return a;var b=new a.constructor;for(var c in a)b[c]=arguments.callee(a[c]);return b},addClass:function(a,b){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");c.test(a.className)||(a.className+=" "+b)},removeClass:function(a,b){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")},cloneHtml5Node:function(a){var b=document.createDocumentFragment(),c=b.createElement?b:document;c.createElement("audio");var d=c.createElement("div");return b.appendChild(d),d.innerHTML=a.outerHTML,d.firstChild},getSwf:function(a){var b=document[a]||window[a];return b.length>1?b[b.length-1]:b}},events:{memoryLeaking:!1,listeners:[],addListener:function(b,d,e){b.addEventListener?b.addEventListener(d,e,!1):b.attachEvent&&(this.listeners.push(b),this.memoryLeaking||(window.attachEvent("onunload",function(){if(this.listeners)for(var b=0,d=this.listeners.length;d>b;b++)c[a].events.purge(this.listeners[b])}),this.memoryLeaking=!0),b.attachEvent("on"+d,function(){e.call(b,window.event)}))},trackLoadProgress:function(a){if(a.settings.preload){var b,c,a=a,d=/(ipod|iphone|ipad)/i.test(navigator.userAgent);b=setInterval(function(){a.element.readyState>-1&&(d||a.init.apply(a)),a.element.readyState>1&&(a.settings.autoplay&&a.play.apply(a),clearInterval(b),c=setInterval(function(){a.loadProgress.apply(a),a.loadedPercent>=1&&clearInterval(c)}))},10),a.readyTimer=b,a.loadTimer=c}},purge:function(a){var b,c=a.attributes;if(c)for(b=0;b<c.length;b+=1)"function"==typeof a[c[b].name]&&(a[c[b].name]=null);if(c=a.childNodes)for(b=0;b<c.length;b+=1)purge(a.childNodes[b])},ready:function(){return function(a){var b=window,c=!1,d=!0,e=b.document,f=e.documentElement,g=e.addEventListener?"addEventListener":"attachEvent",h=e.addEventListener?"removeEventListener":"detachEvent",i=e.addEventListener?"":"on",j=function(d){("readystatechange"!=d.type||"complete"==e.readyState)&&(("load"==d.type?b:e)[h](i+d.type,j,!1),!c&&(c=!0)&&a.call(b,d.type||d))},k=function(){try{f.doScroll("left")}catch(a){return setTimeout(k,50),void 0}j("poll")};if("complete"==e.readyState)a.call(b,"lazy");else{if(e.createEventObject&&f.doScroll){try{d=!b.frameElement}catch(l){}d&&k()}e[g](i+"DOMContentLoaded",j,!1),e[g](i+"readystatechange",j,!1),b[g](i+"load",j,!1)}}}()}},c[b]=function(a,b){this.element=a,this.wrapper=a.parentNode,this.source=a.getElementsByTagName("source")[0]||a,this.mp3=function(a){var b=a.getElementsByTagName("source")[0];return a.getAttribute("src")||(b?b.getAttribute("src"):null)}(a),this.settings=b,this.loadStartedCalled=!1,this.loadedPercent=0,this.duration=1,this.playing=!1},c[b].prototype={updatePlayhead:function(){var a=this.element.currentTime/this.duration;this.settings.updatePlayhead.apply(this,[a])},skipTo:function(a){a>this.loadedPercent||(this.element.currentTime=this.duration*a,this.updatePlayhead())},load:function(b){this.loadStartedCalled=!1,this.source.setAttribute("src",b),this.element.load(),this.mp3=b,c[a].events.trackLoadProgress(this)},loadError:function(){this.settings.loadError.apply(this)},init:function(){this.settings.init.apply(this)},loadStarted:function(){return this.element.duration?(this.duration=this.element.duration,this.updatePlayhead(),this.settings.loadStarted.apply(this),void 0):!1},loadProgress:function(){if(null!=this.element.buffered&&this.element.buffered.length){this.loadStartedCalled||(this.loadStartedCalled=this.loadStarted());var a=this.element.buffered.end(this.element.buffered.length-1);this.loadedPercent=a/this.duration,this.settings.loadProgress.apply(this,[this.loadedPercent])}},playPause:function(){this.playing?this.pause():this.play()},play:function(){var b=/(ipod|iphone|ipad)/i.test(navigator.userAgent);b&&0==this.element.readyState&&this.init.apply(this),this.settings.preload||(this.settings.preload=!0,this.element.setAttribute("preload","auto"),c[a].events.trackLoadProgress(this)),this.playing=!0,this.element.play(),this.settings.play.apply(this)},pause:function(){this.playing=!1,this.element.pause(),this.settings.pause.apply(this)},setVolume:function(a){this.element.volume=a},trackEnded:function(){this.skipTo.apply(this,[0]),this.settings.loop||this.pause.apply(this),this.settings.trackEnded.apply(this)}};var e=function(a,b){var c=[];if(b=b||document,b.getElementsByClassName)c=b.getElementsByClassName(a);else{var d,e,f=b.getElementsByTagName("*"),g=new RegExp("(^|\\s)"+a+"(\\s|$)");for(d=0,e=f.length;e>d;d++)g.test(f[d].className)&&c.push(f[d])}return c.length>1?c:c[0]}}("audiojs","audiojsInstance",this);var Calculated={};Backbone.Calculated=Calculated,function(a,b){var c=a.Model.prototype;
a.Calculated.Model=a.Model.extend({constructor:function(a,d){return this.calculated=this.calculated||{},this._buildTree(),d=b.extend(d||{},{computeAll:!0}),c.constructor.call(this,a,d)},isEqual:function(a){return this.constructor===a.constructor?b.isEqual(this.attibutes,a.attributes):!1},_buildTree:function(){this.dependencies={};for(var a in this.calculated)for(var c=this.calculated[a],d=b.flatten([c.dependencies]),e=this._setNode(a),f=0,g=d.length;g>f;f++)e.connect(this._setNode(d[f]))},_getNode:function(b){var c=this.dependencies[b]||new a.Calculated.Node(b);return c},_setNode:function(a){var b=this._getNode(a);return this.dependencies[a]=b,b},_invalidate:function(a){var b=this;return a.search(function(a){return a.valid?(a.valid=!1,b.calculated[a.id]&&delete b.attributes[a.id],void 0):!1},!0),this},_compute:function(a,c){var d,e,f=this,g=this.attributes,h=this._previousAttributes;return a.search(function(i){return d=i.id,i.valid=i.valid||b.has(g,d),f.calculated[d]&&!i.valid&&i.canCalculate()?(i.valid=!0,e=f.calculated[d].getter.call(f),b.isEqual(g[d],e)||c.push(d),b.isEqual(h[d],e)?delete f.changed[d]:f.changed[d]=e,g[d]=e,void 0):a.id===d}),this},_computeCalculated:function(a,c){var d,e,f=[],g=c&&c.computeAll?b.keys(this.attributes):a;for(d=0,e=g.length;e>d;d++){var h=g[d],i=this.dependencies[h];i&&(this._invalidate(i),f.push(i))}for(d=0,e=f.length;e>d;d++)this._compute(f[d],a,c);return this},recompute:function(a,c){var d=[],e=this._changing,f=this.attributes;this._previousAttributes,this._changing=!0,e||(this._previousAttributes=b.clone(this.attributes),this.changed={}),this._invalidate.apply(this,arguments)._compute.call(this,a,d,c),d.length&&(this._pending=!0);for(var g=0,h=d.length;h>g;g++)this.trigger("change:"+d[g],this,f[d[g]],c);if(e)return this;for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},set:function(c,d,e){var f,g,h,i,j,k,l;if(null==c)return this;if("object"==typeof c?(g=c,e=d):(g={})[c]=d,e=e||{},!this._validate(g,e))return!1;h=e.unset,silent=e.silent,i=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=b.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in g&&(this.id=g[this.idAttribute]);for(f in g)a.isEntity(l[f])&&!a.isEntity(g[f])?l[f].set(g[f],e):(d=g[f],b.isEqual(l[f],d)||i.push(f),b.isEqual(k[f],d)?delete this.changed[f]:this.changed[f]=d,h?delete l[f]:l[f]=d);if(this._computeCalculated(i,e),!silent){i.length&&(this._pending=!0);for(var m=0,n=i.length;n>m;m++)this.trigger("change:"+i[m],this,l[i[m]],e)}if(j)return this;for(;this._pending;)this._pending=!1,this.trigger("change",this,e);return this._pending=!1,this._changing=!1,this},indexOf:function(){return this.collection?this.collection.indexOf(this):-1}})}(window.Backbone,window._),function(a){a.Calculated.Node=function(a){this.id=a,this.inEdges=[],this.outEdges=[]},_.extend(a.Calculated.Node.prototype,{valid:!1,isLeaf:function(){return!this.outEdges.length},canCalculate:function(){for(var a=this.outEdges,b=0,c=a.length;c>b;b++)if(!a[b].valid)return!1;return!0},connect:function(a){this.outEdges.push(a),a.inEdges.push(this)},search:function(a,b){var c,d=[],e={};for(d.push(this),e[this.id]=!0;d.length;){var f=d.shift();if(a(f)!==!1)for(var g=0,h=f.inEdges.length;h>g;g++)c=f.inEdges[g],e[c.id]||(d.push(c),e[c.id]=b||c.valid)}}})}(window.Backbone),function(a,b){var c=b.isEqual;b.isEqual=function(a,b){return a&&a.isEqual&&"function"==typeof a.isEqual?a.isEqual(b):c(a,b)},a.isEntity=function(b){return b instanceof a.Model||b instanceof a.Collection}}(window.Backbone,window._),function(){var a=function(){var a=$('[data-target="soundmanager"]'),b=this;this.sounds={},a.find("audio[data-name]").each(function(){b.sounds[$(this).data("name")]=this})};a.prototype.play=function(a){this.sounds[a]&&(window.chrome&&this.sounds[a].load(),this.sounds[a].play())},window.SoundManager=a}(),function(){window.SC={models:{messageModels:{}},views:{messageViews:{}},factories:{},routers:{}}}(),function(App,undefined){App.tmpl=App.tmpl||{},App.tmpl.message=App.tmpl.message||{},App.tmpl.chatWindow=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<h3>Messages:</h3>\n<div class="chat-window well"></div>\n<div class="input-area"></div>';return __p},App.tmpl.emptyRoom=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<div class="message"><p class="muted">No messages yet</p></div>';return __p},App.tmpl.inputArea=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj)__p+='<form>\n	<div class="row-fluid">\n		<div class="span11"><input '+(null==(__t=rewinding?"disabled":"")?"":__t)+' type="text" class="input-block-level input" placeholder="'+(null==(__t=rewinding?"Input disabled while rewinding":"")?"":__t)+'"></div>\n		<div class="span1"><button '+(null==(__t=rewinding?"disabled":"")?"":__t)+' type="submit" class="btn submit">Send</button></div>\n	</div>\n</form>';return __p},App.tmpl.loggedIn=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj)__p+="<p>You are signed in as "+(null==(__t=user)?"":__t)+' <a class="logout" href="javascript: void(0);">log out</a></p>';return __p},App.tmpl.login=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<form class="form-signin">\n	<h2 class="form-signin-heading">Please sign in</h2>\n\n	<input type="text" class="input-block-level username" placeholder="Username">\n\n	<label class="checkbox">\n		<input type="checkbox" value="remember-me" class="remember"> Remember me\n	</label>\n\n	<button class="btn btn-large btn-primary" type="submit">Sign in</button>\n</form>';return __p},App.tmpl.message.messageNew=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj)__p+="<blockquote>\n	<small>"+(null==(__t=_.escape(user.name)||"You")?"":__t)+" said:</small>\n	<p>"+(null==(__t=parsedBody)?"":__t)+"</p>\n</blockquote>\n";return __p},App.tmpl.message.roomJoin=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj)__p+='<p class="muted">'+(null==(__t=_.escape(user.name))?"":__t)+" has logged in</p>\n";return __p},App.tmpl.message.userLeave=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj)__p+='<p class="muted">'+(null==(__t=_.escape(user.name))?"":__t)+" has left the room</p>\n";return __p},App.tmpl.message.userLogin=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj)__p+='<p class="muted">You have joined the room as '+(null==(__t=_.escape(user.name))?"":__t)+"</p>\n";return __p},App.tmpl.rewind=function(obj){obj||(obj={});var __p="";with(_.escape,Array.prototype.join,obj)__p+='<a href="#" class="dropdown-toggle" data-toggle="dropdown">\n	Rewind Chat\n	<b class="caret"></b>\n</a>\n<ul class="dropdown-menu row">\n	<li class="span12">\n		',__p+=totalMessages>1?'\n			<input type="text" class="slider span12" data-slider-step="1" data-slider-min="0" data-slider-tooltip="show">\n		':1===totalMessages?'\n			<span class="muted">You only have 1 message.</span>\n		':'\n			<span class="muted">No messages yet.</span>\n		',__p+="\n	</li>\n</ul>\n";return __p},App.tmpl.room=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<div class="span8 chat"></div>\n<div class="span4 user-management"></div>';return __p},App.tmpl.userManagement=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<div class="users-list"></div>\n<div class="join-room"></div>';return __p},App.tmpl.user=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj)__p+='<li class="user">'+(null==(__t=name)?"":__t)+"</li>";return __p},App.tmpl.usersList=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<h3>Users in room:</h3>\n\n<ul class="users unstyled">\n	<li class="muted unstyled">No users yet</li>\n</ul>\n\n<div class="you"></div>';return __p}}(this.SC),function(a,b,c){var d=b.Calculated.Model.prototype,e=function(a,b){return this.trigger(a,b),b},f=function(){},g=["open","close","message","error"];a.models.WebSocketModel=b.Calculated.Model.extend({initialize:function(a,b){this.url=b.url||"ws://",this.socket=new WebSocket(this.url),a.messages||this.set("messages",[],{silent:!0}),c.each(g,function(a){var d="on"+a;this.socket[d]=c.compose(b[d]&&c.bind(b[d],this)||f,c.bind(e,this,a))},this),this.on("open",c.partial(this.setReadyStatus,!0)),this.on("close",c.partial(this.setReadyStatus,!1)),this.on("message",this.storeMessage),d.initialize.call(this,a,b)},setReadyStatus:function(a){this.ready=a},send:function(a,b){return this.ready?(a=c.isObject(a)?JSON.stringify(a):a,this.socket.send(a),b!==!1&&this.storeMessage({data:a}),void 0):setTimeout(c.bind(this.send,this,a,b),10)},storeMessage:function(a){var b=c.clone(this.get("messages"));b.push(JSON.parse(a.data)),this.set("messages",b)},close:function(){return this.ready?(this.socket.close(),void 0):setTimeout(this.close,10)}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b){b.Calculated.Model.prototype,a.models.messageModels.AbstractMessage=b.Calculated.Model.extend({defaults:function(){return{user:""}}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b,c){var d=a.models.messageModels.AbstractMessage.prototype;a.models.messageModels.MessageNew=a.models.messageModels.AbstractMessage.extend({defaults:function(){return c.extend(c.result(d,"defaults"),{body:""})},calculated:{parsedBody:{dependencies:"body",getter:function(){var a=this.get("body");return this.replaceUrl(a)}}},replaceUrl:function(a){var b,c,d,e;return c=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,b=a.replace(c,'<a href="$1" target="_blank">$1</a>'),d=/(^|[^\/])(www\.[\S]+(\b|$))/gim,b=b.replace(d,'$1<a href="http://$2" target="_blank">$2</a>'),e=/(\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,6})/gim,b=b.replace(e,'<a href="mailto:$1">$1</a>')}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b,c){var d=a.models.messageModels.AbstractMessage.prototype;a.models.messageModels.RoomJoin=a.models.messageModels.AbstractMessage.extend({defaults:function(){return c.extend(c.result(d,"defaults"),{user:{user_id:0,name:""}})}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b,c){var d=a.models.messageModels.AbstractMessage.prototype;a.models.messageModels.UserLeave=a.models.messageModels.AbstractMessage.extend({defaults:function(){return c.extend(c.result(d,"defaults"),{user:{user_id:0,name:""}})}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b,c){var d=a.models.messageModels.AbstractMessage.prototype;a.models.messageModels.UserLogin=a.models.messageModels.AbstractMessage.extend({defaults:function(){return c.extend(c.result(d,"defaults"),{user:{user_id:0,name:""}})}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b,c){var d=a.models.WebSocketModel.prototype;a.models.Room=a.models.WebSocketModel.extend({defaults:{shownMessageLimit:1/0,rewinding:!1},calculated:{userNames:{dependencies:"users",getter:function(){return c.pluck(this.get("users"),"name")}},users:{dependencies:["messages","shownMessageLimit"],getter:function(){var a=this.get("messages"),b=c.find(a,function(a){return"user_login"===a.cmd&&a.payload.room});return b?(a=c.first(a,this.get("shownMessageLimit")),b=c.sortBy(b.payload.room,function(a){return a.user_id}),c.each(a,function(a){"room_leave"===a.cmd&&b.splice(c.indexOf(b,a.payload.user),1),"room_join"===a.cmd&&b.push(a.payload.user)}),b):[]}},totalMessages:{dependencies:"messages",getter:function(){return this.get("messages").length}},visibleMessages:{dependencies:["messages","shownMessageLimit"],getter:function(){var a=this.get("messages"),b=this.get("shownMessageLimit");return a.slice(0,b)}},totalVisibleMessages:{dependencies:"visibleMessages",getter:function(){return this.get("visibleMessages").length}}},initialize:function(){this.on("change:messages",function(){this.get("rewinding")||this.set("shownMessageLimit",this.get("totalMessages"))}),this.join(this.get("user")),d.initialize.apply(this,arguments)},join:function(a){this.send({cmd:"user_login",payload:{name:a}},!1)},sendMessage:function(a){this.send({cmd:"message_new",payload:{body:a}})}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b,c){b.View.prototype,a.views.ChatWindow=b.View.extend({template:a.tmpl.chatWindow,emptyRoomTmpl:a.tmpl.emptyRoom,initialize:function(){this.listenTo(this.model,"change:visibleMessages",this.renderMessages),this.listenTo(this.model,"change:visibleMessages",this.playSounds)},render:function(){this.$el.html(this.template({})),this.inputArea=new a.views.InputArea({model:this.model,el:this.$(".input-area")}),this.inputArea.render(),this.renderMessages()},renderMessages:function(){var b=this.$el.find(".chat-window").empty();this.model.get("visibleMessages").length||b.html(this.emptyRoomTmpl({})),c.each(this.model.get("visibleMessages"),function(c){var d=a.factories.messageFactory(c.cmd,c.payload);d&&d.render().$el.html()&&b.append(d.$el)},this),b.scrollTop(b[0].scrollHeight)},playSounds:function(){if(this.model.get("rewinding"))return this.stopSounds=!0,void 0;if(this.stopSounds)return this.stopSounds=!1,void 0;var b=this.model.get("visibleMessages"),d=c.last(b);"message_new"===d.cmd&&(d.payload.user?a.soundManager.play("incoming"):a.soundManager.play("sent"))}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b){b.View.prototype,a.views.InputArea=b.View.extend({events:{"submit form":"submit"},template:a.tmpl.inputArea,initialize:function(){this.listenTo(this.model,"change:rewinding",this.render)},render:function(){this.$el.html(this.template(this.model.toJSON()))},submit:function(a){a.preventDefault();var b=this.$(".input"),c=b.val();c&&(this.model.sendMessage(c),b.val(""))}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b){b.View.prototype,a.views.LoggedIn=b.View.extend({events:{"click .logout":"logout"},template:a.tmpl.loggedIn,render:function(){this.$el.html(this.template(this.model.toJSON()))},logout:function(){this.model.close(),a.router.navigate("login",{trigger:!0})}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b){b.View.prototype,a.views.Login=b.View.extend({events:{"submit form":"login"},template:a.tmpl.login,render:function(){this.$el.html(this.template({}))},login:function(b){b.preventDefault();var c=this.$(".username").val(),d=this.$(".remember").is(":checked");d&&localStorage.setItem("username",c),localStorage.setItem("remember",d),a.user=c,a.router.navigate("chat",{trigger:!0})}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b){b.View.prototype,a.views.messageViews.AbstractMessageView=b.View.extend({tagName:"div",className:"message",render:function(){return this.$el.html(this.template(this.model.toJSON())),this}})}(window.SC,window.Backbone,window._,window.jQuery),function(a){a.views.messageViews.AbstractMessageView.prototype,a.views.messageViews.MessageNew=a.views.messageViews.AbstractMessageView.extend({className:"message messageNew",template:a.tmpl.message.messageNew})}(window.SC,window.Backbone,window._,window.jQuery),function(a){a.views.messageViews.AbstractMessageView.prototype,a.views.messageViews.RoomJoin=a.views.messageViews.AbstractMessageView.extend({className:"message roomJoin",template:a.tmpl.message.roomJoin})}(window.SC,window.Backbone,window._,window.jQuery),function(a){a.views.messageViews.AbstractMessageView.prototype,a.views.messageViews.UserLeave=a.views.messageViews.AbstractMessageView.extend({className:"message userLeave",template:a.tmpl.message.userLeave})}(window.SC,window.Backbone,window._,window.jQuery),function(a){a.views.messageViews.AbstractMessageView.prototype,a.views.messageViews.UserLogin=a.views.messageViews.AbstractMessageView.extend({className:"message userLogin",template:a.tmpl.message.userLogin})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b,c){b.View.prototype,a.views.Rewind=b.View.extend({template:a.tmpl.rewind,initialize:function(){this.listenTo(this.model,"change:totalMessages",this.render)},render:function(){var b=this;this.$el.html(this.template(this.model.toJSON())),this.$(".slider").slider({max:this.model.get("totalMessages"),value:Math.min(this.model.get("totalMessages"),this.model.get("shownMessageLimit")),formater:function(c){var d=b.model.get("messages")[c-1];if(!d)return c||"Start";var e=a.factories.messageFactory(d.cmd,d.payload);return e&&e.render().$el.text()||c}}).on("slide",c.bind(this.onSlide,this))},onSlide:c.throttle(function(a){var b=a.value;this.model.set("rewinding",b!==this.model.get("totalMessages")),this.model.set("shownMessageLimit",b)},120)})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b){b.View.prototype,a.views.Room=b.View.extend({template:a.tmpl.room,render:function(){this.$el.html(this.template({})),this.chatWindow=new a.views.ChatWindow({model:this.model,el:this.$(".chat")}),this.chatWindow.render(),this.userManagementView=new a.views.UserManagement({model:this.model,el:this.$(".user-management")}),this.userManagementView.render()}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b){b.View.prototype,a.views.UserManagement=b.View.extend({template:a.tmpl.userManagement,render:function(){this.$el.html(this.template({})),this.usersListView=new a.views.UsersList({model:this.model,el:this.$el.find(".users-list")}),this.usersListView.render(),this.loggedInView=new a.views.LoggedIn({model:this.model,el:this.$el.find(".join-room")}),this.loggedInView.render()}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b){b.View.prototype,a.views.UsersList=b.View.extend({template:a.tmpl.usersList,userTemplate:a.tmpl.user,initialize:function(){this.listenTo(this.model,"change:users",this.render)},render:function(){this.$el.html(this.template({}));var a=this.model.get("users");if(a.length){var b=this;this.$el.find(".users").html(a.reduce(function(a,c){return a+b.userTemplate(c)},""))}}})}(window.SC,window.Backbone,window._,window.jQuery),function(a){a.factories.factoryFactory=function(a){return function(b,c){return a[b]&&new a[b](c)||null}}}(window.SC,window.Backbone,window._,window.jQuery),function(a){a.factories.messageFactory=function(b,c){var d=a.factories.messageModelFactory(b,c);return d?a.factories.messageViewFactory(b,{model:d}):null}}(window.SC,window.Backbone,window._,window.jQuery),function(a){a.factories.messageModelFactory=a.factories.factoryFactory({message_new:a.models.messageModels.MessageNew,room_join:a.models.messageModels.RoomJoin,room_leave:a.models.messageModels.UserLeave,user_login:a.models.messageModels.UserLogin})}(window.SC,window.Backbone,window._,window.jQuery),function(a){a.factories.messageViewFactory=a.factories.factoryFactory({message_new:a.views.messageViews.MessageNew,room_join:a.views.messageViews.RoomJoin,room_leave:a.views.messageViews.UserLeave,user_login:a.views.messageViews.UserLogin})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b,c,d){b.Router.prototype,a.routers.Main=b.Router.extend({routes:{"":"index",login:"login",chat:"chat"},initialize:function(){this.$el=d("#main")},index:function(){a.user?this.navigate("chat"):this.navigate("login",{trigger:!0})},login:function(){this.view=new a.views.Login({el:this.$el,model:a.roomModel||new b.Model}),this.rewindView&&(this.rewindView.$el.empty(),delete this.rewindView),this.view.render()},chat:function(){return a.user?(a.roomModel=new a.models.Room({user:a.user},{url:"ws://107.22.74.86:7061/simplechat/websocket"}),this.view=new a.views.Room({model:a.roomModel,el:this.$el}),this.rewindView=new a.views.Rewind({model:a.roomModel,el:d(".dropdown")}),this.view.render(),this.rewindView.render(),void 0):this.navigate("login",{trigger:!0})}})}(window.SC,window.Backbone,window._,window.jQuery),function(a,b,c,d,e){var f=function(){audiojs.events.ready(function(){audiojs.createAll({createPlayer:!1})}),a.soundManager=new SoundManager,a.router=new a.routers.Main,b.history.start();var c=localStorage.getItem("remember");"true"===c?(a.user=localStorage.getItem("username"),a.user&&a.router.navigate("chat",{trigger:!0})):(localStorage.removeItem("username"),a.user=e)};d(f)}(window.SC,window.Backbone,window._,window.jQuery);